<!DOCTYPE html>
<html>
<head>
	<meta http-equiv="Content-type" content="text/html; charset=utf-8">
	<title>Platform.js</title>
	<link type="text/css" rel="stylesheet" href="style.css" />
	<script type="text/javascript" src="jquery.js"></script> 
	<script type="text/javascript" charset="utf-8">
		
		var ws = null;
		
		function write(content) {
			
			$("#output").prepend("<div class='message'>" +
								"<span class='time'>" + 
									new Date().getHours() + ":" + 
									new Date().getMinutes() + ":" + 
									new Date().getSeconds() + 
								"</span>" + 
								content + 
								"</div>");
		}
		
		$(document).ready(function()
		{
			$("#btnSubmit").click(function() {
				ws.send($('#lblInput').val());
				$('#lblInput').val('');
				$('#lblInput').focus();				
			});
			
			$('#lblInput').keydown(function(event) {
				if(event.keyCode == 13) {
					ws.send($('#lblInput').val());
					$('#lblInput').val('');
					$('#lblInput').focus();
				}	
			});
			
			$('#input').hide();
			
			$('#btnConnect').click(function() {
				
				write("Connecting server ws://" + $('#lblServer').val());
				
				if ("WebSocket" in window) {
				  	ws = new WebSocket("ws://" + $('#lblServer').val());

					ws.onopen = function() {
						write("Socket opened");
					};

				  	ws.onmessage = function (evt) { 
						write(event.data);
					};

				  	ws.onclose = function() {
						write("Socket closed");
					};
				} 
				else {
					write("Browser doesn't support WebSockets!");
				}	
				
				$('#connect').hide();
				$('#input').show();
				$('#lblInput').focus();	
			});
		});

	</script>
	
</head>
<body id="index">
	<div id="content">
		<div class="center">
			<h1>Platform.js</h1>
		
			<div id="input">
				<input id="lblInput" size="60" />
				<input id="btnSubmit" type="button" value="Send &rarr;" />
			</div>
		
			<div id="connect">
				ws://<input id="lblServer" size="60" value="localhost:8000" />
				<input id="btnConnect" type="button" value="Connect &rarr;" />
			</div>
		</div>
		
		<div id="output"></div>
	</div>
</body>
</html>